<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>ESP32</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jaames/iro@5"></script>
  </head>  
  <body>
    <div class="wrap">
      <div class="half">
        <p id="greeting"></p>
        <div class="colorPicker"></div>
      </div>
      <div class="half readout">
        <div class="swatchGrid" id="swatch-grid">
          <div class="swatch" data-color="background:#330000" style="background:#330000"></div>
          <div class="swatch" data-color="background:#331900" style="background:#331900"></div>
          <div class="swatch" data-color="background:#333300" style="background:#333300"></div>
          <div class="swatch" data-color="background:#193300" style="background:#193300"></div>
          <div class="swatch" data-color="background:#003300" style="background:#003300"></div>
          <div class="swatch" data-color="background:#003319" style="background:#003319"></div>
          <div class="swatch" data-color="background:#003333" style="background:#003333"></div>
          <div class="swatch" data-color="background:#001933" style="background:#001933"></div>
          <div class="swatch" data-color="background:#000033" style="background:#000033"></div>
          <div class="swatch" data-color="background:#190033" style="background:#190033"></div>
          <div class="swatch" data-color="background:#330033" style="background:#330033"></div>
          <div class="swatch" data-color="background:#330019" style="background:#330019"></div>
          <div class="swatch" data-color="background:#000000" style="background:#000000"></div>
          <div class="swatch" data-color="background:#660000" style="background:#660000"></div>
          <div class="swatch" data-color="background:#663300" style="background:#663300"></div>
          <div class="swatch" data-color="background:#666600" style="background:#666600"></div>
          <div class="swatch" data-color="background:#336600" style="background:#336600"></div>
          <div class="swatch" data-color="background:#006600" style="background:#006600"></div>
          <div class="swatch" data-color="background:#006633" style="background:#006633"></div>
          <div class="swatch" data-color="background:#006666" style="background:#006666"></div>
          <div class="swatch" data-color="background:#003366" style="background:#003366"></div>
          <div class="swatch" data-color="background:#000066" style="background:#000066"></div>
          <div class="swatch" data-color="background:#330066" style="background:#330066"></div>
          <div class="swatch" data-color="background:#660066" style="background:#660066"></div>
          <div class="swatch" data-color="background:#660033" style="background:#660033"></div>
          <div class="swatch" data-color="background:#202020" style="background:#202020"></div>
          <div class="swatch" data-color="background:#990000" style="background:#990000"></div>
          <div class="swatch" data-color="background:#994C00" style="background:#994C00"></div>
          <div class="swatch" data-color="background:#999900" style="background:#999900"></div>
          <div class="swatch" data-color="background:#4C9900" style="background:#4C9900"></div>
          <div class="swatch" data-color="background:#009900" style="background:#009900"></div>
          <div class="swatch" data-color="background:#00994C" style="background:#00994C"></div>
          <div class="swatch" data-color="background:#009999" style="background:#009999"></div>
          <div class="swatch" data-color="background:#004C99" style="background:#004C99"></div>
          <div class="swatch" data-color="background:#000099" style="background:#000099"></div>
          <div class="swatch" data-color="background:#4C0099" style="background:#4C0099"></div>
          <div class="swatch" data-color="background:#990099" style="background:#990099"></div>
          <div class="swatch" data-color="background:#99004C" style="background:#99004C"></div>
          <div class="swatch" data-color="background:#404040" style="background:#404040"></div>
          <div class="swatch" data-color="background:#CC0000" style="background:#CC0000"></div>
          <div class="swatch" data-color="background:#CC6600" style="background:#CC6600"></div>
          <div class="swatch" data-color="background:#CCCC00" style="background:#CCCC00"></div>
          <div class="swatch" data-color="background:#66CC00" style="background:#66CC00"></div>
          <div class="swatch" data-color="background:#00CC00" style="background:#00CC00"></div>
          <div class="swatch" data-color="background:#00CC66" style="background:#00CC66"></div>
          <div class="swatch" data-color="background:#00CCCC" style="background:#00CCCC"></div>
          <div class="swatch" data-color="background:#0066CC" style="background:#0066CC"></div>
          <div class="swatch" data-color="background:#0000CC" style="background:#0000CC"></div>
          <div class="swatch" data-color="background:#6600CC" style="background:#6600CC"></div>
          <div class="swatch" data-color="background:#CC00CC" style="background:#CC00CC"></div>
          <div class="swatch" data-color="background:#CC0066" style="background:#CC0066"></div>
          <div class="swatch" data-color="background:#606060" style="background:#606060"></div>
          <div class="swatch" data-color="background:#FF0000" style="background:#FF0000"></div>
          <div class="swatch" data-color="background:#FF8000" style="background:#FF8000"></div>
          <div class="swatch" data-color="background:#FFFF00" style="background:#FFFF00"></div>
          <div class="swatch" data-color="background:#80FF00" style="background:#80FF00"></div>
          <div class="swatch" data-color="background:#00FF00" style="background:#00FF00"></div>
          <div class="swatch" data-color="background:#00FF80" style="background:#00FF80"></div>
          <div class="swatch" data-color="background:#00FFFF" style="background:#00FFFF"></div>
          <div class="swatch" data-color="background:#0080FF" style="background:#0080FF"></div>
          <div class="swatch" data-color="background:#0000FF" style="background:#0000FF"></div>
          <div class="swatch" data-color="background:#7F00FF" style="background:#7F00FF"></div>
          <div class="swatch" data-color="background:#FF00FF" style="background:#FF00FF"></div>
          <div class="swatch" data-color="background:#FF007F" style="background:#FF007F"></div>
          <div class="swatch" data-color="background:#808080" style="background:#808080"></div>
          <div class="swatch" data-color="background:#FF3333" style="background:#FF3333"></div>
          <div class="swatch" data-color="background:#FF9933" style="background:#FF9933"></div>
          <div class="swatch" data-color="background:#FFFF33" style="background:#FFFF33"></div>
          <div class="swatch" data-color="background:#99FF33" style="background:#99FF33"></div>
          <div class="swatch" data-color="background:#33FF33" style="background:#33FF33"></div>
          <div class="swatch" data-color="background:#33FF99" style="background:#33FF99"></div>
          <div class="swatch" data-color="background:#33FFFF" style="background:#33FFFF"></div>
          <div class="swatch" data-color="background:#3399FF" style="background:#3399FF"></div>
          <div class="swatch" data-color="background:#3333FF" style="background:#3333FF"></div>
          <div class="swatch" data-color="background:#9933FF" style="background:#9933FF"></div>
          <div class="swatch" data-color="background:#FF33FF" style="background:#FF33FF"></div>
          <div class="swatch" data-color="background:#FF3399" style="background:#FF3399"></div>
          <div class="swatch" data-color="background:#A0A0A0" style="background:#A0A0A0"></div>
          <div class="swatch" data-color="background:#FF6666" style="background:#FF6666"></div>
          <div class="swatch" data-color="background:#FFB266" style="background:#FFB266"></div>
          <div class="swatch" data-color="background:#FFFF66" style="background:#FFFF66"></div>
          <div class="swatch" data-color="background:#B2FF66" style="background:#B2FF66"></div>
          <div class="swatch" data-color="background:#66FF66" style="background:#66FF66"></div>
          <div class="swatch" data-color="background:#66FFB2" style="background:#66FFB2"></div>
          <div class="swatch" data-color="background:#66FFFF" style="background:#66FFFF"></div>
          <div class="swatch" data-color="background:#66B2FF" style="background:#66B2FF"></div>
          <div class="swatch" data-color="background:#6666FF" style="background:#6666FF"></div>
          <div class="swatch" data-color="background:#B266FF" style="background:#B266FF"></div>
          <div class="swatch" data-color="background:#FF66FF" style="background:#FF66FF"></div>
          <div class="swatch" data-color="background:#FF66B2" style="background:#FF66B2"></div>
          <div class="swatch" data-color="background:#C0C0C0" style="background:#C0C0C0"></div>
          <div class="swatch" data-color="background:#FF9999" style="background:#FF9999"></div>
          <div class="swatch" data-color="background:#FFCC99" style="background:#FFCC99"></div>
          <div class="swatch" data-color="background:#FFFF99" style="background:#FFFF99"></div>
          <div class="swatch" data-color="background:#CCFF99" style="background:#CCFF99"></div>
          <div class="swatch" data-color="background:#99FF99" style="background:#99FF99"></div>
          <div class="swatch" data-color="background:#99FFCC" style="background:#99FFCC"></div>
          <div class="swatch" data-color="background:#99FFFF" style="background:#99FFFF"></div>
          <div class="swatch" data-color="background:#99CCFF" style="background:#99CCFF"></div>
          <div class="swatch" data-color="background:#9999FF" style="background:#9999FF"></div>
          <div class="swatch" data-color="background:#CC99FF" style="background:#CC99FF"></div>
          <div class="swatch" data-color="background:#FF99FF" style="background:#FF99FF"></div>
          <div class="swatch" data-color="background:#FF99CC" style="background:#FF99CC"></div>
          <div class="swatch" data-color="background:#E0E0E0" style="background:#E0E0E0"></div>
          <div class="swatch" data-color="background:#FFCCCC" style="background:#FFCCCC"></div>
          <div class="swatch" data-color="background:#FFE5CC" style="background:#FFE5CC"></div>
          <div class="swatch" data-color="background:#FFFFCC" style="background:#FFFFCC"></div>
          <div class="swatch" data-color="background:#E5FFCC" style="background:#E5FFCC"></div>
          <div class="swatch" data-color="background:#CCFFCC" style="background:#CCFFCC"></div>
          <div class="swatch" data-color="background:#CCFFE5" style="background:#CCFFE5"></div>
          <div class="swatch" data-color="background:#CCFFFF" style="background:#CCFFFF"></div>
          <div class="swatch" data-color="background:#CCE5FF" style="background:#CCE5FF"></div>
          <div class="swatch" data-color="background:#CCCCFF" style="background:#CCCCFF"></div>
          <div class="swatch" data-color="background:#E5CCFF" style="background:#E5CCFF"></div>
          <div class="swatch" data-color="background:#FFCCFF" style="background:#FFCCFF"></div>
          <div class="swatch" data-color="background:#FFCCE5" style="background:#FFCCE5"></div>
          <div class="swatch" data-color="background:#FFFFFF" style="background:#FFFFFF"></div>
        </div>
        <span class="title">Selected Color:</span>
        <div id="values"></div>
      </div>
    </div>
  </body>
  <style>
    body {
      font-family: monospace;
      color: #fff;
      background: #171F30;
      line-height: 150%;
      font-size: 24px;
    }

    .wrap {
      min-height: 100vh;
      max-width: 720px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .half {
      padding: 32px 0;
    }

    .readout {
      margin-top: 32px;
      line-height: 180%;
    }

    #values {
     font-family: monospace;
     line-height: 150%;
    }

    .swatchGrid {
      display: grid;
      grid-template-columns: repeat(13, 63px);
      grid-template-rows: repeat(9, 63px);
      grid-gap: 10px;
      margin-bottom: 1em;
    }

    .swatch {
      border-radius: 4px;
      cursor: pointer;
    }

    a {
      color: blue;
    }
  </style>
  <script type="application/javascript">
    // Let Telegram WebApp know that we're ready
    Telegram.WebApp.ready();

    // const initData = Telegram.WebApp.initData || '';
    // const initDataUnsafe = Telegram.WebApp.initDataUnsafe || {};
    // document.querySelector('#greeting').innerHTML = `Select a Color`;
    
    // Create a new color picker instance
    // https://iro.js.org/guide.html#getting-started
    var colorPicker = new iro.ColorPicker(".colorPicker", {
      // color picker options
      // Option guide: https://iro.js.org/guide.html#color-picker-options
      width: 650,
      color: "rgb(255, 0, 0)",
      borderWidth: 2,
      borderColor: "#fff",
    });

    // Handle click events on the swatch
    var swatchGrid = document.getElementById('swatch-grid');
    swatchGrid.addEventListener('click', function(e) {
      var clickTarget = e.target;
      
      // Read data-color attribute
      if (clickTarget.dataset.color) {
        // Update the color picker
        colorPicker.color.set(clickTarget.dataset.color);
        const data = JSON.stringify({ rgb: colorPicker.color.rgb });
        Telegram.WebApp.sendData(data);
      }
    });

    // Update the "selected color" values whenever the color changes
    // https://iro.js.org/guide.html#color-picker-events
    var values = document.getElementById("values");
    
    // Initialise colorPicker
    colorPicker.on(["color:init", "color:change"], function(color) {
      // Show the current color in different formats
      // Using the selected color: https://iro.js.org/guide.html#selected-color-api
      values.innerHTML = [
        "hex: " + color.hexString,
        "rgb: " + color.rgbString,
        "hsl: " + color.hslString,
      ].join("<br/>");
    });

    Telegram.WebApp.MainButton.setText('Save').show().onClick(function () {
        const data = JSON.stringify({ rgb: colorPicker.color.rgb });
        Telegram.WebApp.sendData(data);
        Telegram.WebApp.close();
    });

    Telegram.WebApp.expand();
    Telegram.WebApp.enableClosingConfirmation();
  </script>
</html>
