<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>ESP32</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jaames/iro@5"></script>
  </head>  
  <body>
    <div class="wrap">
      <div class="half">
        <p id="greeting"></p>
        <div class="colorPicker"></div>
      </div>
      <div class="half readout">
        <div class="patternGrid" id="pattern-grid">
          <div class="pattern" data-pattern="0" style="background-image: linear-gradient(violet, indigo, blue, green, yellow, orange, red);"></div>
          <div class="pattern" data-pattern="1" style="background-image: linear-gradient(violet, white, indigo, white, blue, white, green, white, yellow, orange, white, red);"></div>
          <div class="pattern" data-pattern="2" style="background-image: radial-gradient(#ff8a00, #e52e71);"></div>
          <div class="pattern" data-pattern="3" style="background-image: linear-gradient(red, yellow);"></div>
          <div class="pattern" data-pattern="4" style="background-image: linear-gradient(red, yellow);"></div>
          <div class="pattern" data-pattern="5" style="background-image: linear-gradient(red, yellow);"></div>
        </div>
      </div>
      <div class="half readout">
        <div class="swatchGrid" id="swatch-grid">
          <div class="swatch" data-color="#330000" style="background:#330000"></div>
          <div class="swatch" data-color="#331900" style="background:#331900"></div>
          <div class="swatch" data-color="#333300" style="background:#333300"></div>
          <div class="swatch" data-color="#193300" style="background:#193300"></div>
          <div class="swatch" data-color="#003300" style="background:#003300"></div>
          <div class="swatch" data-color="#003319" style="background:#003319"></div>
          <div class="swatch" data-color="#003333" style="background:#003333"></div>
          <div class="swatch" data-color="#001933" style="background:#001933"></div>
          <div class="swatch" data-color="#000033" style="background:#000033"></div>
          <div class="swatch" data-color="#190033" style="background:#190033"></div>
          <div class="swatch" data-color="#330033" style="background:#330033"></div>
          <div class="swatch" data-color="#330019" style="background:#330019"></div>
          <div class="swatch" data-color="#000000" style="background:#000000"></div>
          <div class="swatch" data-color="#660000" style="background:#660000"></div>
          <div class="swatch" data-color="#663300" style="background:#663300"></div>
          <div class="swatch" data-color="#666600" style="background:#666600"></div>
          <div class="swatch" data-color="#336600" style="background:#336600"></div>
          <div class="swatch" data-color="#006600" style="background:#006600"></div>
          <div class="swatch" data-color="#006633" style="background:#006633"></div>
          <div class="swatch" data-color="#006666" style="background:#006666"></div>
          <div class="swatch" data-color="#003366" style="background:#003366"></div>
          <div class="swatch" data-color="#000066" style="background:#000066"></div>
          <div class="swatch" data-color="#330066" style="background:#330066"></div>
          <div class="swatch" data-color="#660066" style="background:#660066"></div>
          <div class="swatch" data-color="#660033" style="background:#660033"></div>
          <div class="swatch" data-color="#202020" style="background:#202020"></div>
          <div class="swatch" data-color="#990000" style="background:#990000"></div>
          <div class="swatch" data-color="#994C00" style="background:#994C00"></div>
          <div class="swatch" data-color="#999900" style="background:#999900"></div>
          <div class="swatch" data-color="#4C9900" style="background:#4C9900"></div>
          <div class="swatch" data-color="#009900" style="background:#009900"></div>
          <div class="swatch" data-color="#00994C" style="background:#00994C"></div>
          <div class="swatch" data-color="#009999" style="background:#009999"></div>
          <div class="swatch" data-color="#004C99" style="background:#004C99"></div>
          <div class="swatch" data-color="#000099" style="background:#000099"></div>
          <div class="swatch" data-color="#4C0099" style="background:#4C0099"></div>
          <div class="swatch" data-color="#990099" style="background:#990099"></div>
          <div class="swatch" data-color="#99004C" style="background:#99004C"></div>
          <div class="swatch" data-color="#404040" style="background:#404040"></div>
          <div class="swatch" data-color="#CC0000" style="background:#CC0000"></div>
          <div class="swatch" data-color="#CC6600" style="background:#CC6600"></div>
          <div class="swatch" data-color="#CCCC00" style="background:#CCCC00"></div>
          <div class="swatch" data-color="#66CC00" style="background:#66CC00"></div>
          <div class="swatch" data-color="#00CC00" style="background:#00CC00"></div>
          <div class="swatch" data-color="#00CC66" style="background:#00CC66"></div>
          <div class="swatch" data-color="#00CCCC" style="background:#00CCCC"></div>
          <div class="swatch" data-color="#0066CC" style="background:#0066CC"></div>
          <div class="swatch" data-color="#0000CC" style="background:#0000CC"></div>
          <div class="swatch" data-color="#6600CC" style="background:#6600CC"></div>
          <div class="swatch" data-color="#CC00CC" style="background:#CC00CC"></div>
          <div class="swatch" data-color="#CC0066" style="background:#CC0066"></div>
          <div class="swatch" data-color="#606060" style="background:#606060"></div>
          <div class="swatch" data-color="#FF0000" style="background:#FF0000"></div>
          <div class="swatch" data-color="#FF8000" style="background:#FF8000"></div>
          <div class="swatch" data-color="#FFFF00" style="background:#FFFF00"></div>
          <div class="swatch" data-color="#80FF00" style="background:#80FF00"></div>
          <div class="swatch" data-color="#00FF00" style="background:#00FF00"></div>
          <div class="swatch" data-color="#00FF80" style="background:#00FF80"></div>
          <div class="swatch" data-color="#00FFFF" style="background:#00FFFF"></div>
          <div class="swatch" data-color="#0080FF" style="background:#0080FF"></div>
          <div class="swatch" data-color="#0000FF" style="background:#0000FF"></div>
          <div class="swatch" data-color="#7F00FF" style="background:#7F00FF"></div>
          <div class="swatch" data-color="#FF00FF" style="background:#FF00FF"></div>
          <div class="swatch" data-color="#FF007F" style="background:#FF007F"></div>
          <div class="swatch" data-color="#808080" style="background:#808080"></div>
          <div class="swatch" data-color="#FF3333" style="background:#FF3333"></div>
          <div class="swatch" data-color="#FF9933" style="background:#FF9933"></div>
          <div class="swatch" data-color="#FFFF33" style="background:#FFFF33"></div>
          <div class="swatch" data-color="#99FF33" style="background:#99FF33"></div>
          <div class="swatch" data-color="#33FF33" style="background:#33FF33"></div>
          <div class="swatch" data-color="#33FF99" style="background:#33FF99"></div>
          <div class="swatch" data-color="#33FFFF" style="background:#33FFFF"></div>
          <div class="swatch" data-color="#3399FF" style="background:#3399FF"></div>
          <div class="swatch" data-color="#3333FF" style="background:#3333FF"></div>
          <div class="swatch" data-color="#9933FF" style="background:#9933FF"></div>
          <div class="swatch" data-color="#FF33FF" style="background:#FF33FF"></div>
          <div class="swatch" data-color="#FF3399" style="background:#FF3399"></div>
          <div class="swatch" data-color="#A0A0A0" style="background:#A0A0A0"></div>
          <div class="swatch" data-color="#FF6666" style="background:#FF6666"></div>
          <div class="swatch" data-color="#FFB266" style="background:#FFB266"></div>
          <div class="swatch" data-color="#FFFF66" style="background:#FFFF66"></div>
          <div class="swatch" data-color="#B2FF66" style="background:#B2FF66"></div>
          <div class="swatch" data-color="#66FF66" style="background:#66FF66"></div>
          <div class="swatch" data-color="#66FFB2" style="background:#66FFB2"></div>
          <div class="swatch" data-color="#66FFFF" style="background:#66FFFF"></div>
          <div class="swatch" data-color="#66B2FF" style="background:#66B2FF"></div>
          <div class="swatch" data-color="#6666FF" style="background:#6666FF"></div>
          <div class="swatch" data-color="#B266FF" style="background:#B266FF"></div>
          <div class="swatch" data-color="#FF66FF" style="background:#FF66FF"></div>
          <div class="swatch" data-color="#FF66B2" style="background:#FF66B2"></div>
          <div class="swatch" data-color="#C0C0C0" style="background:#C0C0C0"></div>
          <div class="swatch" data-color="#FF9999" style="background:#FF9999"></div>
          <div class="swatch" data-color="#FFCC99" style="background:#FFCC99"></div>
          <div class="swatch" data-color="#FFFF99" style="background:#FFFF99"></div>
          <div class="swatch" data-color="#CCFF99" style="background:#CCFF99"></div>
          <div class="swatch" data-color="#99FF99" style="background:#99FF99"></div>
          <div class="swatch" data-color="#99FFCC" style="background:#99FFCC"></div>
          <div class="swatch" data-color="#99FFFF" style="background:#99FFFF"></div>
          <div class="swatch" data-color="#99CCFF" style="background:#99CCFF"></div>
          <div class="swatch" data-color="#9999FF" style="background:#9999FF"></div>
          <div class="swatch" data-color="#CC99FF" style="background:#CC99FF"></div>
          <div class="swatch" data-color="#FF99FF" style="background:#FF99FF"></div>
          <div class="swatch" data-color="#FF99CC" style="background:#FF99CC"></div>
          <div class="swatch" data-color="#E0E0E0" style="background:#E0E0E0"></div>
          <div class="swatch" data-color="#FFCCCC" style="background:#FFCCCC"></div>
          <div class="swatch" data-color="#FFE5CC" style="background:#FFE5CC"></div>
          <div class="swatch" data-color="#FFFFCC" style="background:#FFFFCC"></div>
          <div class="swatch" data-color="#E5FFCC" style="background:#E5FFCC"></div>
          <div class="swatch" data-color="#CCFFCC" style="background:#CCFFCC"></div>
          <div class="swatch" data-color="#CCFFE5" style="background:#CCFFE5"></div>
          <div class="swatch" data-color="#CCFFFF" style="background:#CCFFFF"></div>
          <div class="swatch" data-color="#CCE5FF" style="background:#CCE5FF"></div>
          <div class="swatch" data-color="#CCCCFF" style="background:#CCCCFF"></div>
          <div class="swatch" data-color="#E5CCFF" style="background:#E5CCFF"></div>
          <div class="swatch" data-color="#FFCCFF" style="background:#FFCCFF"></div>
          <div class="swatch" data-color="#FFCCE5" style="background:#FFCCE5"></div>
          <div class="swatch" data-color="#FFFFFF" style="background:#FFFFFF"></div>
        </div>
        <span class="title">Selected Color:</span>
        <div id="values"></div>
      </div>
    </div>
  </body>
  <style>
    body {
      font-family: monospace;
      color: #fff;
      background: #171F30;
      line-height: 150%;
      font-size: 24px;
    }

    .wrap {
      min-height: 100vh;
      max-width: 720px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .half {
      padding: 32px 0;
    }

    .readout {
      margin-top: 32px;
      line-height: 180%;
    }

    #values {
     font-family: monospace;
     line-height: 150%;
    }

    .swatchGrid {
      display: grid;
      grid-template-columns: repeat(13, 63px);
      grid-template-rows: repeat(9, 63px);
      grid-gap: 10px;
      margin-bottom: 1em;
    }

    .swatch {
      border-radius: 4px;
      cursor: pointer;
    }

    .patternGrid {
      display: grid;
      grid-template-columns: repeat(3, 163px);
      grid-template-rows: repeat(3, 63px);
      grid-gap: 10px;
    }

    .pattern {
      border-radius: 8px;
      cursor: pointer;
    }

    a {
      color: blue;
    }
  </style>
  <script type="application/javascript">
    // Let Telegram WebApp know that we're ready
    Telegram.WebApp.ready();

    // const initData = Telegram.WebApp.initData || '';
    // const initDataUnsafe = Telegram.WebApp.initDataUnsafe || {};
    // document.querySelector('#greeting').innerHTML = `Select a Color`;
    
    // Create a new color picker instance
    // https://iro.js.org/guide.html#getting-started
    var colorPicker = new iro.ColorPicker(".colorPicker", {
      // color picker options
      // Option guide: https://iro.js.org/guide.html#color-picker-options
      width: 650,
      color: "rgb(255, 0, 0)",
      borderWidth: 2,
      borderColor: "#fff",
    });

    // Handle click events on the swatches
    var swatchGrid = document.getElementById('swatch-grid');
    swatchGrid.addEventListener('click', function(e) {
      var clickTarget = e.target;
      
      // Read data-color attribute
      if (clickTarget.dataset.color) {
        // Update the color picker
        colorPicker.color.set(clickTarget.dataset.color);
        const data = JSON.stringify({ rgb: colorPicker.color.rgb });
        Telegram.WebApp.sendData(data);
      }
    });
    
    // Handle click events on the patterns
    var patternGrid = document.getElementById('pattern-grid');
    patternGrid.addEventListener('click', function(e) {
      var clickTarget = e.target;
      
      // Read data-color attribute
      if (clickTarget.dataset.pattern) {
        // Update the color picker
        colorPicker.color.set(clickTarget.dataset.pattern);
        const data = JSON.stringify({ pattern: clickTarget.dataset.pattern });
        Telegram.WebApp.sendData(data);
      }
    });

    // Update the "selected color" values whenever the color changes
    // https://iro.js.org/guide.html#color-picker-events
    var values = document.getElementById("values");
    
    // Initialise colorPicker
    colorPicker.on(["color:init", "color:change"], function(color) {
      // Show the current color in different formats
      // Using the selected color: https://iro.js.org/guide.html#selected-color-api
      values.innerHTML = [
        "hex: " + color.hexString,
        "rgb: " + color.rgbString,
        "hsl: " + color.hslString,
      ].join("<br/>");
    });

    Telegram.WebApp.MainButton.setText('Save').show().onClick(function () {
        const data = JSON.stringify({ rgb: colorPicker.color.rgb });
        Telegram.WebApp.sendData(data);
        Telegram.WebApp.close();
    });

    Telegram.WebApp.expand();
    Telegram.WebApp.enableClosingConfirmation();
  </script>
</html>
